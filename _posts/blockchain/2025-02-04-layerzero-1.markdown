---
layout: post
title: "LayerZero Omnichain Applications & Omnichain Fungible Tokens"
date: "2025-02-04 10:56:44 +0900"
tags: [blockchain]
---

# LayerZero

# Overview

ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” LayerZeroë¥¼ ì‚¬ìš©í•˜ì—¬ OApp(Omnichain Applications)ê³¼ OFT(Omnichain Fungible Tokens)ë¥¼ ë°°í¬í•˜ê³  ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

# Getting Started with Contract Standards

LayerZeroì˜ **Contract Standards** ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ì˜ì˜ ë°ì´í„°, í† í° ë“±ì„ í•´ë‹¹ í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- [Omnichain Application (OApp)](https://docs.layerzero.network/v2/developers/evm/oapp/overview): omnichain ë©”ì‹œì§• ë° êµ¬ì„±ì„ ìœ„í•œ ê¸°ë³¸ contract í‘œì¤€.
- [Omnichain Fungible Token (OFT)](https://docs.layerzero.network/v2/developers/evm/oft/quickstart): ERC20 ì „ì†¡ì„ ì²˜ë¦¬í•˜ê³  ì§€ì›í•˜ê¸° ìœ„í•´ êµ¬ì¶•ëœ OApp í™•ì¥.
- [Omnichain Non-Fungible Token (ONFT)](https://docs.layerzero.network/v2/developers/evm/onft/quickstart): omnichain ERC721 ì „ì†¡ì„ ì²˜ë¦¬í•˜ê³  ì§€ì›í•˜ê¸° ìœ„í•´ êµ¬ì¶•ëœ í™•ì¥.

ì´ í‘œì¤€ë“¤ì€ LayerZero Endpoint contractë¥¼ í†µí•´ omnichain ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³ , ë°›ê³ , êµ¬ì„±í•˜ê¸° ìœ„í•œ ê³µí†µ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ìˆìŠµë‹ˆë‹¤.

- `OAppSender._lzSend`: `EndpointV2.send` ë¥¼ í˜¸ì¶œí•˜ì—¬ byte ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” Internal function
- `OAppReceiver._lzReceive` :`EndpointV2.lzReceive` ë¥¼ í˜¸ì¶œí•œ ë’¤ encoded messageë¥¼ byteë¡œ ì „ë‹¬í•˜ëŠ” internal function

# Quickstart - Create Your First Omnichain App

## **Creating an OApp**

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```bash
npx create-lz-oapp@latest
```

## **OApp Smart Contract**

í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ë©´ `MyOApp.sol` ì»¨íŠ¸ë™íŠ¸ê°€ ìˆìŠµë‹ˆë‹¤.

```solidity
// contracts/MyOApp.sol

// SPDX-License-Identifier: MIT

pragma solidity ^0.8.22;

import { Ownable } from "@openzeppelin/contracts/access/Ownable.sol";
import { OApp, MessagingFee, Origin } from "@layerzerolabs/oapp-evm/contracts/oapp/OApp.sol";
import { MessagingReceipt } from "@layerzerolabs/oapp-evm/contracts/oapp/OAppSender.sol";

contract MyOApp is OApp {
    constructor(address _endpoint, address _delegate) OApp(_endpoint, _delegate) Ownable(_delegate) {}

    // This is where the message will be stored after it is received on the destination chain
    string public data = "Nothing received yet.";

    /**
     * @notice Sends a message from the source chain to a destination chain.
     * @param _dstEid The endpoint ID of the destination chain.
     * @param _message The message string to be sent.
     * @param _options Additional options for message execution.
     * @dev Encodes the message as bytes and sends it using the `_lzSend` internal function.
     * @return receipt A `MessagingReceipt` struct containing details of the message sent.
     */
    function send(
        uint32 _dstEid,
        // The message to be sent to the destination chain
        string memory _message,
        bytes calldata _options
    ) external payable returns (MessagingReceipt memory receipt) {
        bytes memory _payload = abi.encode(_message);
        receipt = _lzSend(_dstEid, _payload, _options, MessagingFee(msg.value, 0), payable(msg.sender));
    }

    /**
     * @notice Quotes the gas needed to pay for the full omnichain transaction in native gas or ZRO token.
     * @param _dstEid Destination chain's endpoint ID.
     * @param _message The message.
     * @param _options Message execution options (e.g., for sending gas to destination).
     * @param _payInLzToken Whether to return fee in ZRO token.
     * @return fee A `MessagingFee` struct containing the calculated gas fee in either the native token or ZRO token.
     */
    function quote(
        uint32 _dstEid,
        string memory _message,
        bytes memory _options,
        bool _payInLzToken
    ) public view returns (MessagingFee memory fee) {
        bytes memory payload = abi.encode(_message);
        fee = _quote(_dstEid, payload, _options, _payInLzToken);
    }

    /**
     * @dev Internal function override to handle incoming messages from another chain.
     * @dev _origin A struct containing information about the message sender.
     * @dev _guid A unique global packet identifier for the message.
     * @param payload The encoded message payload being received.
     *
     * @dev The following params are unused in the current implementation of the OApp.
     * @dev _executor The address of the Executor responsible for processing the message.
     * @dev _extraData Arbitrary data appended by the Executor to the message.
     *
     * Decodes the received payload and processes it as per the business logic defined in the function.
     */
    function _lzReceive(
        Origin calldata /*_origin*/,
        bytes32 /*_guid*/,
        bytes calldata payload,
        address /*_executor*/,
        bytes calldata /*_extraData*/
    ) internal override {
        data = abi.decode(payload, (string));
    }
}
```

## **Configuration**

`hardhat.config.ts` ì— ë°°í¬í•  ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

```tsx
networks: {
    'avalanche-testnet': {
        eid: EndpointId.AVALANCHE_V2_TESTNET,
        url: process.env.RPC_URL_FUJI || 'https://rpc.ankr.com/avalanche_fuji',
        accounts,
    },
    'amoy-testnet': {
        eid: EndpointId.AMOY_V2_TESTNET,
        url: process.env.RPC_URL_AMOY || 'https://polygon-amoy-bor-rpc.publicnode.com',
        accounts,
    },
}

```

Â `.env.example`Â ë¥¼ ë³µì‚¬í•´Â `.env`Â  ë¥¼ ë§Œë“¤ê³  `.env`ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤. 

```tsx
PRIVATE_KEY = your_private_key; // Required
RPC_URL_FUJI = your_fuji_rpc; // Optional but recommended
RPC_URL_AMOY = your_amoy_rpc; // Optional but recommended
```

## **Deploying Contracts**

ì•„ë˜ ëª…ë ì–´ë¥¼ ì´ìš©í•˜ì—¬ ë°°í¬í•©ë‹ˆë‹¤.

```bash
npx hardhat lz:deploy
```

![image.png](/assets/post/2025-02-04-layerzero-1/image.png)

## Configuration and wiring

ì´ì œ Chainê°„ Contractë¥¼ ì—°ê²°í•  ìˆ˜ ìˆëŠ” ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì„¤ì •ì„ êµ¬ì„±í•´ì•¼í•©ë‹ˆë‹¤. í•´ë‹¹ ì„¤ì •ì€ `layerzero.config.ts` ì— êµ¬ì„±í•©ë‹ˆë‹¤.

```tsx
// layerzero.config.ts
import {EndpointId} from '@layerzerolabs/lz-definitions';

import type {OAppOmniGraphHardhat, OmniPointHardhat} from '@layerzerolabs/toolbox-hardhat';

const fujiContract: OmniPointHardhat = {
  eid: EndpointId.AVALANCHE_V2_TESTNET,
  contractName: 'MyOApp',
};

const amoyContract: OmniPointHardhat = {
  eid: EndpointId.AMOY_V2_TESTNET,
  contractName: 'MyOApp',
};

const config: OAppOmniGraphHardhat = {
  contracts: [
    {
      contract: fujiContract,
    },
    {
      contract: amoyContract,
    },
  ],
  connections: [
    {
      from: fujiContract,
      to: amoyContract,
    },
    {
      from: amoyContract,
      to: fujiContract,
    },
  ],
};

export default config;
```

ì„¤ì •ì„ ë‹¤ êµ¬ì„± í–ˆë‹¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ contractë“¤ì„ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
npx hardhat lz:oapp:wire --oapp-config layerzero.config.ts
```

ê²°ê³¼ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥ ë©ë‹ˆë‹¤.

![image](/assets/post/2025-02-04-layerzero-1/image%201.png)
    
## **Sending Your First Message**

ì´ì œ ì‹¤ì œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê¸° ìœ„í•´ tsíŒŒì¼ë¡œ scriptë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.

`tasks/sendMessage.ts` ë¡œ ìƒˆ íŒŒì¼ì„ ë§Œë“¤ê³  ì•„ë˜ ì½”ë“œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

```tsx
// tasks/sendMessage.ts

import {task} from 'hardhat/config';
import {HardhatRuntimeEnvironment} from 'hardhat/types';

import {Options} from '@layerzerolabs/lz-v2-utilities';

export default task('sendMessage', 'Send a message to the destination chain')
  .addParam('dstNetwork', 'The destination network name (from hardhat.config.ts)')
  .addParam('message', 'The message to send')
  .setAction(async (taskArgs, hre: HardhatRuntimeEnvironment) => {
    const {message, dstNetwork} = taskArgs;
    const [signer] = await hre.ethers.getSigners();

    // Get destination network's EID
    const dstNetworkConfig = hre.config.networks[dstNetwork];
    const dstEid = dstNetworkConfig.eid;

    // Get current network's EID
    const srcNetworkConfig = hre.config.networks[hre.network.name];
    const srcEid = srcNetworkConfig?.eid;

    console.log('Sending message:');
    console.log('- From:', signer.address);
    console.log('- Source network:', hre.network.name, srcEid ? `(EID: ${srcEid})` : '');
    console.log('- Destination:', dstNetwork || 'unknown network', `(EID: ${dstEid})`);
    console.log('- Message:', message);

    const myOApp = await hre.deployments.get('MyOApp');
    const contract = await hre.ethers.getContractAt('MyOApp', myOApp.address, signer);

    // Add executor options with gas limit
    const options = Options.newOptions().addExecutorLzReceiveOption(200000, 0).toBytes();

    // Get quote for the message
    console.log('Getting quote...');
    const quotedFee = await contract.quote(dstEid, message, options, false);
    console.log('Quoted fee:', hre.ethers.utils.formatEther(quotedFee.nativeFee));

    // Send the message
    console.log('Sending message...');
    const tx = await contract.send(dstEid, message, options, {value: quotedFee.nativeFee});

    const receipt = await tx.wait();
    console.log('ğŸ‰ Message sent! Transaction hash:', receipt.transactionHash);
    console.log(
      'Check message status on LayerZero Scan: https://testnet.layerzeroscan.com/tx/' +
        receipt.transactionHash,
    );
  });
```

ë˜í•œ `hardhat.config.ts` ì—ë„ ìœ„ì—ì„œ ë§Œë“  íŒŒì¼ì„ Import í•©ë‹ˆë‹¤.

```tsx
// hardhat.config.ts
// (...)
import {EndpointId} from '@layerzerolabs/lz-definitions';
import './tasks/sendMessage'; // Import the task

```

ì´í›„ ì•„ë˜ ëª…ë ¹ì–´ë¡œ cross-chain messageë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
npx hardhat sendMessage --network avalanche-testnet --dst-network amoy-testnet --message "Hello Omnichain World (sent from Avalanche)"

# ì‹¤ì œë¡œëŠ” amoyë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  sepoliaë¥¼ ì‚¬ìš©í–ˆìŒ (Gas fee ì—†ì–´ì„œ)
npx hardhat sendMessage --network sepolia-testnet --dst-network avalanche-testnet --message "Hello Omnichain World (sent from Seploia)"
```

ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```tsx
Sending message:
- From: 0x498098ca1b7447fC5035f95B80be97eE16F82597
- Source network: avalanche-testnet (EID: 40106)
- Destination: amoy-testnet (EID: 40267)
- Message: Hello Omnichain World (sent from Avalanche)
Getting quote...
Quoted fee: 0.004605311339306711
Sending message...
ğŸ‰ Message sent! Transaction hash: 0x47bd60f2710c2ec5a496c55c9763bd87fd4c599b541ad1287540fce9852ede65
Check message status on LayerzeRo Scan: https://testnet.layerzeroscan.com/tx/0x47bd60f2710c2ec5a496c55c9763bd87fd4c599b541ad1287540fce9852ede65
```

- ì‹¤íŒ¨ ( avax â†’ sepolia )
    
    ![image.png](/assets/post/2025-02-04-layerzero-1/image%202.png)
    

![image.png](/assets/post/2025-02-04-layerzero-1/image%203.png)

![image.png](/assets/post/2025-02-04-layerzero-1/image%204.png)

# LayerZero V2 OFT

![oft](https://i.imgur.com/PSpgH48.png)

OFTëŠ” ëª¨ë“  ì²´ì¸ì— ë°°í¬ë˜ì–´ì•¼ í•˜ë©°, ê° ì²´ì¸ì—ì„œ í† í°ì„ ë°œí–‰í•˜ê³  ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê° ì²´ì¸ê°„ ì „ì†¡í•˜ëŠ” ê³¼ì •ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ Burn & Mint ì²˜ë¦¬ê°€ ë©ë‹ˆë‹¤.

![oftadapter](https://i.imgur.com/bW3uDuk.png)

ë§Œì•½ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ERC20ì„ ì‚¬ìš©í•˜ì—¬ OFTAdapterë¥¼ êµ¬ì„±í•œ ê²½ìš° Lock & Mint ì²˜ë¦¬ê°€ ë©ë‹ˆë‹¤.

## Installation

ì•„ë˜ ëª…ë ¹ì–´ë¡œ OFTê°€ í¬í•¨ëœ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
npx create-lz-oapp
```

![image.png](/assets/post/2025-02-04-layerzero-1/image%205.png)

ì¶”ê°€ë¡œ ì•„ë˜ ëª…ë ¹ì–´ë¡œ npm íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
pnpm add @layerzerolabs/oft-evm
```

OFTë¥¼ ìƒì„±í•˜ë ¤ë©´, í† í°ì„ ì¡´ì¬ì‹œí‚¤ê³ ì í•˜ëŠ” ëª¨ë“  ì²´ì¸ì— OFT Contractë¥¼ ë°°í¬í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ë¯¸ í•´ë‹¹ ì²´ì¸ì— í† í°ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°, í•´ë‹¹ í† í°ì˜ ì¤‘ê°œ ì—­í• ì„ í•˜ëŠ” Lock Boxë¡œì„œ OFT Adapter Contractë¥¼ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ OFTëŠ” ERC20 ê·œì¹™ì„ ë”°ë¥´ë©°, `decimals` ê°’ì„ `18`ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ê°’ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì»¨íŠ¸ë™íŠ¸ì—ì„œ *decimals() í•¨ìˆ˜ë¥¼ ì˜¤ë²„ë¼ì´ë“œí•´ì•¼ í•©ë‹ˆë‹¤*.

## **Deployment Workflow**

1. OFTë¥¼ ì—°ê²°í•˜ë ¤ëŠ” ëª¨ë“  ì²´ì¸ì— ë°°í¬
    
    OFTë¥¼ ìƒì„±í•˜ë ¤ë©´, í† í°ì„ ì¡´ì¬ì‹œí‚¤ê³ ì í•˜ëŠ” ëª¨ë“  ì²´ì¸ì— OFT ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•´ì•¼ í•©ë‹ˆë‹¤.
    
2. setPeerë¥¼ ì‚¬ìš©í•˜ì—¬ ì²´ì¸ ê°„ ì—°ê²°
    
    OFTëŠ” OAppì„ í™•ì¥í•˜ë¯€ë¡œ, OFT.setPeerë¥¼ í˜¸ì¶œí•˜ì—¬ ê° ëŒ€ìƒ ì²´ì¸ì˜ ì»¨íŠ¸ë™íŠ¸ë¥¼ í—ˆìš© ëª©ë¡(whitelist)ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
    
3. DVN(Decentralized Verification Network) ì„¤ì •
    
    ë¸”ë¡ í™•ì¸(block confirmations), ë³´ì•ˆ ì„ê³„ê°’(security threshold), ì‹¤í–‰ì(Executor), ìµœëŒ€ ë©”ì‹œì§€ í¬ê¸°(max message size), ì†¡Â·ìˆ˜ì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬(send/receive libraries) ë“±ì˜ ì„¤ì •ì„ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
    
4. ë³´ì•ˆ ë° ì‹¤í–‰ì(Executor) ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ ì°¸ê³ 
    
    ë³´ì•ˆ ë° ì‹¤í–‰ì ì„¤ì •ê³¼ ê´€ë ¨ëœ ì˜ˆì œ ìŠ¤í¬ë¦½íŠ¸ëŠ” â€œSecurity and Executor Configurationâ€ ì„¹ì…˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
5. ê°€ìŠ¤ ì„¤ì • (ê¶Œì¥ ì˜µì…˜)
    
    OFTëŠ” OAppOptionsType3ì„ ìƒì†ë°›ìœ¼ë¯€ë¡œ, ì‚¬ìš©ìê°€ aOFT.sendë¥¼ í˜¸ì¶œí•  ë•Œ íŠ¹ì • ê°€ìŠ¤ ì„¤ì •ì„ ê°•ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
6. OFTAdapterë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° (í•„ìˆ˜ ì„¤ì •)
    
    OFTAdapterë¥¼ ì‚¬ìš©í•  ê²½ìš°, ì „ì†¡í•  í† í°ì˜ ì–‘ë§Œí¼ ERC20.approveë¥¼ í˜¸ì¶œí•˜ì—¬ OFTAdapterê°€ ERC20 í† í°ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìŠ¹ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
    

## Deploy

1. `hardhat.config.ts` êµ¬ì„±
    
    ë³¸ë¬¸ì—ì„œëŠ” amoyë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì„ê±°ë¼ ì œê±°í–ˆìŒ
    
    ![image.png](/assets/post/2025-02-04-layerzero-1/image%206.png)
    
2. Mint function ì¶”ê°€
    - í…œí”Œë¦¿ì—” mintê°€ ë³„ë„ë¡œ ì—†ê¸° ë•Œë¬¸ì— ì¶”ê°€í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
        - í”„ë¡œë•ì…˜ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ `onlyOwner` ê°™ì€ modifier ë¥¼ ë°˜ë“œì‹œ ë„£ì–´ì£¼ì„¸ìš”
        
        ```solidity
        // SPDX-License-Identifier: UNLICENSED
        pragma solidity ^0.8.22;
        
        import { Ownable } from "@openzeppelin/contracts/access/Ownable.sol";
        import { OFT } from "@layerzerolabs/oft-evm/contracts/OFT.sol";
        
        contract MyOFT is OFT {
            constructor(
                string memory _name,
                string memory _symbol,
                address _lzEndpoint,
                address _delegate
            ) OFT(_name, _symbol, _lzEndpoint, _delegate) Ownable(_delegate) {}
        
            // Mint function
            function mint(address to, uint256 amount) external virtual {
                _mint(to, amount);
            }
        }
        
        ```
        
3. ë¹Œë“œ
    
    ```bash
    pnpm install # Install dependencies
    pnpm compile # Compile contract
    ```
    
    ![image.png](/assets/post/2025-02-04-layerzero-1/image%207.png)
    
4. `.env` êµ¬ì„±
    - RenameÂ `.env.example`Â ->Â `.env`
    - Choose your preferred means of setting up your deployer wallet/account:
    
    ```toml
    MNEMONIC="test test test test test test test test test test test junk"
    or...
    PRIVATE_KEY="0xabc...def"
    ```
    
5. ë°°í¬
    
    ```toml
    npx hardhat lz:deploy
    ```
    
    ![image.png](/assets/post/2025-02-04-layerzero-1/image%208.png)
    
6. `layerzero.config.ts` êµ¬ì„±
    
    ì‹¤ì œ ì»¨íŠ¸ë™íŠ¸ë¥¼ ì—°ê²°í•  ì²´ì¸ë“¤ì„ êµ¬ì„±
    
    ë³¸ë¬¸ì—ì„œëŠ” amoyë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ ì œê±°í–ˆìŒ
    
    ![image.png](/assets/post/2025-02-04-layerzero-1/image%209.png)
    
7. Contract wire
    
    ```bash
    npx hardhat lz:oapp:wire --oapp-config layerzero.config.ts
    ```
    
    ![image.png](/assets/post/2025-02-04-layerzero-1/image%2010.png)
    
8. Mint Task ìƒì„± í›„ ì‹¤í–‰
    - `tasks/mint.ts`
        
        ```tsx
        // tasks/mint.ts
        
        import { task } from 'hardhat/config';
        import { HardhatRuntimeEnvironment } from 'hardhat/types';
        
        import { Options } from '@layerzerolabs/lz-v2-utilities';
        
        export default task('mint', 'Mint a token to the destination chain')
          .addParam('amount', 'The amount of tokens to mint')
          .setAction(async (taskArgs, hre: HardhatRuntimeEnvironment) => {
            const { amount } = taskArgs;
            const [signer] = await hre.ethers.getSigners();
        
            console.log('Minting tokens:');
            console.log('- From:', signer.address);
            console.log('- Amount:', amount);
        
            const myOFT = await hre.deployments.get('MyOFT');
            const contract = await hre.ethers.getContractAt('MyOFT', myOFT.address, signer);
        
            // Send the message
            console.log('Sending message...');
            const tx = await contract.mint(signer.address, amount);
        
            const receipt = await tx.wait();
            console.log('ğŸ‰ Tokens minted! Transaction hash:', receipt.transactionHash);
          });
        ```
        
    - `hardhat.config.ts` ì— ì¶”ê°€
        
        ```tsx
        import { EndpointId } from '@layerzerolabs/lz-definitions'
        import "./tasks/mint" // ì¶”ê°€
        
        // Set your preferred authentication method
        ```
        
    - ì‹¤í–‰
        
        ```bash
        npx hardhat mint --network sepolia-testnet --amount 10000000000000000000
        ```
        
        ![image.png](/assets/post/2025-02-04-layerzero-1/image%2011.png)
        
        ![image.png](/assets/post/2025-02-04-layerzero-1/image%2012.png)
        
9. sendToken ìƒì„± í›„ ì‹¤í–‰
    
    ```tsx
    // tasks/sendToken.ts
    
    import { task } from 'hardhat/config';
    import { HardhatRuntimeEnvironment } from 'hardhat/types';
    
    import { Options } from '@layerzerolabs/lz-v2-utilities';
    
    export default task('sendToken', 'Send a token to the destination chain')
        .addParam('dstNetwork', 'The destination network name (from hardhat.config.ts)')
        .addParam('amount', 'The amount of tokens to send')
        .setAction(async (taskArgs, hre: HardhatRuntimeEnvironment) => {
            const { amount, dstNetwork } = taskArgs;
            const [signer] = await hre.ethers.getSigners();
    
            const addressAsBytes32 = "0x0000000000000000000000002f32e86e8fc5e762aa32a09d4970cb3216fefaf4";
    
            // Get destination network's EID
            const dstNetworkConfig = hre.config.networks[dstNetwork];
            const dstEid = dstNetworkConfig.eid;
    
            // Get current network's EID
            const srcNetworkConfig = hre.config.networks[hre.network.name];
            const srcEid = srcNetworkConfig?.eid;
    
            console.log('Sending message:');
            console.log('- From:', signer.address);
            console.log('- Source network:', hre.network.name, srcEid ? `(EID: ${srcEid})` : '');
            console.log('- Destination:', dstNetwork || 'unknown network', `(EID: ${dstEid})`);
            console.log('- Amount:', amount);
    
            const myOFT = await hre.deployments.get('MyOFT');
            const contract = await hre.ethers.getContractAt('MyOFT', myOFT.address, signer);
    
            // Add executor options with gas limit
            const options = Options.newOptions().addExecutorLzReceiveOption(200000, 0).toBytes();
    
            // Get quote for the message
            console.log('Getting quote...');
            const sendParam = {
                dstEid: dstEid,
                to: addressAsBytes32,
                amountLD: amount,
                minAmountLD: amount,
                extraOptions: options,
                composeMsg: "0x00",
                oftCmd: "0x00"
            }
            const quotedFee = await contract.quoteSend(sendParam, false);
            console.log('Quoted fee:', hre.ethers.utils.formatEther(quotedFee.nativeFee));
    
            // Send the message
            console.log('Sending tokens...');
            const tx = await contract.send(sendParam, quotedFee, signer.address, {value: quotedFee.nativeFee});
    
            const receipt = await tx.wait();
            console.log('ğŸ‰ Tokens sent! Transaction hash:', receipt.transactionHash);
            console.log(
                'Check token balance on LayerZero Scan: https://testnet.layerzeroscan.com/tx/' +
                receipt.transactionHash,
            );
        });
    ```
    
    ```tsx
    import { EndpointId } from '@layerzerolabs/lz-definitions'
    import "./tasks/mint"
    import "./tasks/sendToken" // ì¶”ê°€
    ```
    
    ```bash
    npx hardhat sendToken --network sepolia-testnet --dst-network avalanche-testnet --amount 1000000000000000000
    ```
    
    ![image.png](/assets/post/2025-02-04-layerzero-1/image%2013.png)
    
    - ì•„ë˜ì™€ ê°™ì´ LayerZero Explorerì—ì„œë„ í™•ì¸í•  ìˆ˜ ìˆìŒ
        
        ![image.png](/assets/post/2025-02-04-layerzero-1/image%2014.png)
        
    - ì‹¤ì œ Fuji chainì— ì „ì†¡ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ
        
        ![image.png](/assets/post/2025-02-04-layerzero-1/image%2015.png)
        
    - Source Chainì—ì„œëŠ” sendì™€ í•¨ê»˜ Burn ì²˜ë¦¬ë¨
        
        ![image.png](/assets/post/2025-02-04-layerzero-1/image%2016.png)
        

# TroubleShooting

- Message Blocked
    
    ![image.png](/assets/post/2025-02-04-layerzero-1/image%2017.png)
    
    - Configì´ ì˜ëª»ë˜ëŠ” ê²½ìš° Blockedê°€ ë˜ëŠ” ê²½ìš°ê°€ ìˆìŒ
        - `create-lz-oapp` ì„ ì‚¬ìš©í•´ì„œ ë§Œë“œëŠ” í”„ë¡œì íŠ¸ì˜ ê¸°ë³¸ì„¤ì •ì„ ì‚¬ìš©í–ˆëŠ”ë° ê·¸ê²Œ ë¬¸ì œê°€ ëœ ê²ƒ ê°™ìŒ
        - `layerzero.config.ts` ì˜ connections ë¶€ë¶„ì„ ìˆ˜ì •
            - ì´ìƒí•œ ì˜µì…˜ì„ ì‹¹ ì œê±°í•¨
            
            ```
                connections: [
                    {
                        from: fujiContract,
                        to: sepoliaContract,
                    },
                    {
                        from: sepoliaContract,
                        to: fujiContract,
                    }
                ],
            ```