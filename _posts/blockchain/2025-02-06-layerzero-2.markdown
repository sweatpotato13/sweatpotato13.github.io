---
layout: post
title: "LayerZero Omnichain Not Fungible Tokens (ONFT)"
date: "2025-02-06 10:56:44 +0900"
tags: [blockchain]
---

# LayerZero

# Overview

[ì´ì „ í¬ìŠ¤íŒ…](/2025/02/04/layerzero-1/)ì—ì„œ LayerZeroë¥¼ ì‚¬ìš©í•˜ì—¬ OApp(Omnichain Applications)ê³¼ OFT(Omnichain Fungible Tokens)ë¥¼ ë°°í¬í•˜ê³  ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì„ ë‹¤ë¤„ë³´ì•˜ìŠµë‹ˆë‹¤.
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„  ONFT(Omnichain Non-Fungible Tokens)ë¥¼ ë°°í¬í•˜ê³  ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì„ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤.

# LayerZero V2 ONFT

ONFTë„ OFTì™€ ê°™ì´ ì‚¬ìš©í•˜ë ¤ëŠ” ëª¨ë“  ì²´ì¸ì— ONFT ì»¨íŠ¸ë™íŠ¸ê°€ ë°°í¬ ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

ì´í›„ OFTì™€ ë™ì¼í•˜ê²Œ í† í° ì „ì†¡ì‹œ bufn & mint ë¡œì§ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

![image.png](/assets/post/2025-02-06-layerzero-2/image%2017.png)

## Installation

ì•„ë˜ ëª…ë ¹ì–´ë¡œ ONFTê°€ í¬í•¨ëœ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`ONFT721` ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ í”„ë¡œì íŠ¸ì— OFTê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```bash
npx create-lz-oapp
```

![image.png](/assets/post/2025-02-06-layerzero-2/image%2018.png)

ì´í›„ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€ ì„¤ì¹˜ í•´ì¤ë‹ˆë‹¤.

```bash
pnpm add @layerzerolabs/onft-evm
```

## Deploy

1. `hardhat.config.ts` êµ¬ì„±
    
    ë³¸ë¬¸ì—ì„œëŠ” amoyë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì„ê±°ë¼ ì œê±°í–ˆìŒ
    
    ![image.png](/assets/post/2025-02-06-layerzero-2/image%206.png)
    
2. Mint function ì¶”ê°€
    - í…œí”Œë¦¿ì—” mintê°€ ë³„ë„ë¡œ ì—†ê¸° ë•Œë¬¸ì— ì¶”ê°€í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
        - í”„ë¡œë•ì…˜ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ `onlyOwner` ê°™ì€ modifier ë¥¼ ë°˜ë“œì‹œ ë„£ì–´ì£¼ì„¸ìš”
        
        ```solidity
        // SPDX-License-Identifier: UNLICENSED
        pragma solidity ^0.8.22;
        
        import { ONFT721 } from "@layerzerolabs/onft-evm/contracts/onft721/ONFT721.sol";
        
        contract MyONFT721 is ONFT721 {
            constructor(
                string memory _name,
                string memory _symbol,
                address _lzEndpoint,
                address _delegate
            ) ONFT721(_name, _symbol, _lzEndpoint, _delegate) {}
        
            function mint(address to, uint256 tokenId) external virtual {
                _mint(to, tokenId);
            }
        }
        
        ```
        
3. ë¹Œë“œ
    
    ```bash
    pnpm install # Install dependencies
    pnpm compile # Compile contract
    ```
    
    ![image.png](/assets/post/2025-02-06-layerzero-2/image%2019.png)
    
4. `.env` êµ¬ì„±
    - RenameÂ `.env.example`Â ->Â `.env`
    - Choose your preferred means of setting up your deployer wallet/account:
    
    ```toml
    MNEMONIC="test test test test test test test test test test test junk"
    or...
    PRIVATE_KEY="0xabc...def"
    ```
    
5. ë°°í¬
    
    ```toml
    npx hardhat lz:deploy
    ```
    
    ![image.png](/assets/post/2025-02-06-layerzero-2/image%2020.png)
    
6. `layerzero.config.ts` êµ¬ì„±
    
    ì‹¤ì œ ì»¨íŠ¸ë™íŠ¸ë¥¼ ì—°ê²°í•  ì²´ì¸ë“¤ì„ êµ¬ì„±
    
    ë³¸ë¬¸ì—ì„œëŠ” amoyë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ ì œê±°í–ˆìŒ
    
    ![image.png](/assets/post/2025-02-06-layerzero-2/image%209.png)
    
7. Contract wire
    
    ```bash
    npx hardhat lz:oapp:wire --oapp-config layerzero.config.ts
    ```
    
    ![image.png](/assets/post/2025-02-06-layerzero-2/image%2021.png)
    
8. Mint Task ìƒì„± í›„ ì‹¤í–‰
    - `tasks/mint.ts`
        
        ```tsx
        // tasks/mint.ts
        
        import { task } from 'hardhat/config';
        import { HardhatRuntimeEnvironment } from 'hardhat/types';
        
        export default task('mint', 'Mint a token to the destination chain')
          .addParam('id', 'The token id to mint')
          .setAction(async (taskArgs, hre: HardhatRuntimeEnvironment) => {
            const { id } = taskArgs;
            const [signer] = await hre.ethers.getSigners();
        
            console.log('Minting tokens:');
            console.log('- From:', signer.address);
            console.log('- Token ID:', id);
        
            const myONFT721 = await hre.deployments.get('MyONFT721');
            const contract = await hre.ethers.getContractAt('MyONFT721', myONFT721.address, signer);
        
            // Send the message
            console.log('Sending message...');
            const tx = await contract.mint(signer.address, id);
        
            const receipt = await tx.wait();
            console.log('ğŸ‰ Tokens minted! Transaction hash:', receipt.transactionHash);
          });
        ```
        
    - `hardhat.config.ts` ì— ì¶”ê°€
        
        ```tsx
        import { EndpointId } from '@layerzerolabs/lz-definitions'
        import "./tasks/mint" // ì¶”ê°€
        
        // Set your preferred authentication method
        ```
        
    - ì‹¤í–‰
        
        ```bash
        npx hardhat mint --network sepolia-testnet --id 1
        ```
        
        ![image.png](/assets/post/2025-02-06-layerzero-2/image%2022.png)
        
        ![image.png](/assets/post/2025-02-06-layerzero-2/image%2023.png)
        
9. sendToken ìƒì„± í›„ ì‹¤í–‰
    
    ```tsx
    // tasks/sendToken.ts
    
    import { task } from 'hardhat/config';
    import { HardhatRuntimeEnvironment } from 'hardhat/types';
    
    import { Options } from '@layerzerolabs/lz-v2-utilities';
    
    export default task('sendToken', 'Send a token to the destination chain')
        .addParam('dstNetwork', 'The destination network name (from hardhat.config.ts)')
        .addParam('id', 'The token id to send')
        .setAction(async (taskArgs, hre: HardhatRuntimeEnvironment) => {
            const { id, dstNetwork } = taskArgs;
            const [signer] = await hre.ethers.getSigners();
    
            const addressAsBytes32 = "0x0000000000000000000000002f32e86e8fc5e762aa32a09d4970cb3216fefaf4";
    
            // Get destination network's EID
            const dstNetworkConfig = hre.config.networks[dstNetwork];
            const dstEid = dstNetworkConfig.eid;
    
            // Get current network's EID
            const srcNetworkConfig = hre.config.networks[hre.network.name];
            const srcEid = srcNetworkConfig?.eid;
    
            console.log('Sending message:');
            console.log('- From:', signer.address);
            console.log('- Source network:', hre.network.name, srcEid ? `(EID: ${srcEid})` : '');
            console.log('- Destination:', dstNetwork || 'unknown network', `(EID: ${dstEid})`);
            console.log('- Token ID:', id);
    
            const myONFT721 = await hre.deployments.get('MyONFT721');
            const contract = await hre.ethers.getContractAt('MyONFT721', myONFT721.address, signer);
    
            // Add executor options with gas limit
            const options = Options.newOptions().addExecutorLzReceiveOption(200000, 0).toBytes();
    
            // Get quote for the message
            console.log('Getting quote...');
            const sendParam = {
                dstEid: dstEid,
                to: addressAsBytes32,
                tokenId: id,
                extraOptions: options,
                composeMsg: "0x00",
                onftCmd: "0x00"
            }    
            const quotedFee = await contract.quoteSend(sendParam, false);
            console.log('Quoted fee:', hre.ethers.utils.formatEther(quotedFee.nativeFee));
    
            // Send the message
            console.log('Sending tokens...');
            const tx = await contract.send(sendParam, quotedFee, signer.address, {value: quotedFee.nativeFee});
    
            const receipt = await tx.wait();
            console.log('ğŸ‰ Tokens sent! Transaction hash:', receipt.transactionHash);
            console.log(
                'Check token balance on LayerZero Scan: https://testnet.layerzeroscan.com/tx/' +
                receipt.transactionHash,
            );
        });
    ```
    
    ```tsx
    import { EndpointId } from '@layerzerolabs/lz-definitions'
    import "./tasks/mint"
    import "./tasks/sendToken" // ì¶”ê°€
    ```
    
    ```bash
    npx hardhat sendToken --network sepolia-testnet --dst-network avalanche-testnet --id 1
    ```
    
    ![image.png](/assets/post/2025-02-06-layerzero-2/image%2024.png)
    
    - ì•„ë˜ì™€ ê°™ì´ LayerZero Explorerì—ì„œë„ í™•ì¸í•  ìˆ˜ ìˆìŒ
        
        ![image.png](/assets/post/2025-02-06-layerzero-2/image%2025.png)
        
    - Source Chainì—ì„œ ì²˜ë¦¬ ë¨
        
        ![image.png](/assets/post/2025-02-06-layerzero-2/image%2026.png)
        
        - tokenì„ zero addressë¡œ ë³´ë‚¸ ê²ƒìœ¼ë¡œ burnì²˜ë¦¬ í•˜ì˜€ìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ
    - ì‹¤ì œ Fuji chainì— ì „ì†¡ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ
        
        ![image.png](/assets/post/2025-02-06-layerzero-2/image%2027.png)
        
        - ì‹¤ì œ mint í˜•ì‹ìœ¼ë¡œ ì „ì†¡ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ
